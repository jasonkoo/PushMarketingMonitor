package com.lenovo.lps.push.marketing.monitor.jsonentity;

import java.io.IOException;
import java.text.ParseException;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import org.codehaus.jackson.JsonGenerationException;
import org.codehaus.jackson.map.JsonMappingException;

import com.lenovo.lps.push.marketing.monitor.entity.HitPvUv;
import com.lenovo.lps.push.marketing.monitor.util.DateUtil;
import com.lenovo.lps.push.marketing.monitor.util.JsonUtil;


public class JsonData6 {
	
	private String hm;
	private String norm;
	public String getHm() {
		return hm;
	}
	public void setHm(String hm) {
		this.hm = hm;
	}
	public String getNorm() {
		return norm;
	}
	public void setNorm(String norm) {
		this.norm = norm;
	}
	
	public static String pvUvList2JsonStringByMinute5New(
			ArrayList<HitPvUv> pvUvList, boolean isYesterday)
			throws ParseException, JsonGenerationException, JsonMappingException, IOException {
		//[{"hm":"1400515200000","norm":"317"},{"hm":"1400518800000","norm":"215407"},{"hm":"1400519100000","norm":"213282"},{"hm":"1400519400000","norm":"210609"},{"hm":"1400519700000","norm":"209158"},{"hm":"1400520000000","norm":"207770"},{"hm":"1400520300000","norm":"206222"},{"hm":"1400520600000","norm":"201932"},{"hm":"1400520900000","norm":"200482"},{"hm":"1400521200000","norm":"197378"},{"hm":"1400521500000","norm":"196214"},{"hm":"1400521800000","norm":"195789"},{"hm":"1400522100000","norm":"195070"},{"hm":"1400522400000","norm":"192603"},{"hm":"1400522700000","norm":"191041"},{"hm":"1400523000000","norm":"189212"},{"hm":"1400523300000","norm":"188124"},{"hm":"1400523600000","norm":"185325"},{"hm":"1400523900000","norm":"184933"},{"hm":"1400524200000","norm":"173788"},{"hm":"1400524500000","norm":"183200"},{"hm":"1400524800000","norm":"177221"},{"hm":"1400525100000","norm":"185562"},{"hm":"1400525400000","norm":"173387"},{"hm":"1400525700000","norm":"179608"},{"hm":"1400526000000","norm":"202"},{"hm":"1400533200000","norm":"180165"},{"hm":"1400533500000","norm":"184395"},{"hm":"1400533800000","norm":"192825"},{"hm":"1400534100000","norm":"197819"},{"hm":"1400534400000","norm":"204346"},{"hm":"1400534700000","norm":"207479"},{"hm":"1400535000000","norm":"215381"},{"hm":"1400535300000","norm":"216691"},{"hm":"1400535600000","norm":"222164"},{"hm":"1400535900000","norm":"224268"},{"hm":"1400536200000","norm":"228880"},{"hm":"1400536500000","norm":"231179"},{"hm":"1400536800000","norm":"249621"},{"hm":"1400537100000","norm":"243013"},{"hm":"1400537400000","norm":"247304"},{"hm":"1400537700000","norm":"247928"},{"hm":"1400538000000","norm":"252281"},{"hm":"1400538300000","norm":"257731"},{"hm":"1400538600000","norm":"267781"},{"hm":"1400538900000","norm":"267173"},{"hm":"1400539200000","norm":"263991"},{"hm":"1400539500000","norm":"265781"},{"hm":"1400539800000","norm":"268238"},{"hm":"1400540100000","norm":"269661"},{"hm":"1400540400000","norm":"279755"},{"hm":"1400540700000","norm":"275589"},{"hm":"1400541000000","norm":"280928"},{"hm":"1400541300000","norm":"279034"},{"hm":"1400541600000","norm":"278811"},{"hm":"1400541900000","norm":"279181"},{"hm":"1400542200000","norm":"278849"},{"hm":"1400542500000","norm":"277112"},{"hm":"1400542800000","norm":"277720"},{"hm":"1400543100000","norm":"278385"},{"hm":"1400543400000","norm":"280215"},{"hm":"1400543700000","norm":"283276"},{"hm":"1400544000000","norm":"287637"},{"hm":"1400544300000","norm":"289459"},{"hm":"1400544600000","norm":"290943"},{"hm":"1400544900000","norm":"292176"},{"hm":"1400545200000","norm":"294822"},{"hm":"1400545500000","norm":"296098"},{"hm":"1400545800000","norm":"298278"},{"hm":"1400546100000","norm":"296316"},{"hm":"1400546400000","norm":"298867"},{"hm":"1400546700000","norm":"300215"},{"hm":"1400547000000","norm":"302912"},{"hm":"1400547300000","norm":"301547"},{"hm":"1400547600000","norm":"304556"},{"hm":"1400547900000","norm":"303280"},{"hm":"1400548200000","norm":"304951"},{"hm":"1400548500000","norm":"301875"},{"hm":"1400548800000","norm":"304621"},{"hm":"1400549100000","norm":"305405"},{"hm":"1400549400000","norm":"308076"},{"hm":"1400549700000","norm":"307349"},{"hm":"1400550000000","norm":"309447"},{"hm":"1400550300000","norm":"309114"},{"hm":"1400550600000","norm":"310387"},{"hm":"1400550900000","norm":"310935"},{"hm":"1400551200000","norm":"314680"},{"hm":"1400551500000","norm":"313412"},{"hm":"1400551800000","norm":"311712"},{"hm":"1400552100000","norm":"313319"},{"hm":"1400552400000","norm":"318983"},{"hm":"1400552700000","norm":"319643"},{"hm":"1400553000000","norm":"317861"},{"hm":"1400553300000","norm":"317780"},{"hm":"1400553600000","norm":"315249"},{"hm":"1400553900000","norm":"316989"},{"hm":"1400554200000","norm":"318020"},{"hm":"1400554500000","norm":"316361"},{"hm":"1400554800000","norm":"317604"},{"hm":"1400555100000","norm":"320642"},{"hm":"1400555400000","norm":"321466"},{"hm":"1400555700000","norm":"320381"},{"hm":"1400556000000","norm":"320765"},{"hm":"1400556300000","norm":"319342"},{"hm":"1400556600000","norm":"319755"},{"hm":"1400556900000","norm":"320656"},{"hm":"1400557200000","norm":"321799"},{"hm":"1400557500000","norm":"322783"},{"hm":"1400557800000","norm":"326718"},{"hm":"1400558100000","norm":"327142"},{"hm":"1400558400000","norm":"332136"},{"hm":"1400558700000","norm":"331736"},{"hm":"1400559000000","norm":"334033"},{"hm":"1400559300000","norm":"336904"},{"hm":"1400559600000","norm":"341122"},{"hm":"1400559900000","norm":"340565"},{"hm":"1400560200000","norm":"344434"},{"hm":"1400560500000","norm":"341247"},{"hm":"1400560800000","norm":"342191"},{"hm":"1400561100000","norm":"341858"},{"hm":"1400561400000","norm":"341736"},{"hm":"1400561700000","norm":"343373"},{"hm":"1400562000000","norm":"343353"},{"hm":"1400562300000","norm":"341394"},{"hm":"1400562600000","norm":"340872"},{"hm":"1400562900000","norm":"340385"},{"hm":"1400563200000","norm":"338188"},{"hm":"1400563500000","norm":"335294"},{"hm":"1400563800000","norm":"333455"},{"hm":"1400564100000","norm":"228294"},{"hm":"1400564400000","norm":"283998"},{"hm":"1400564700000","norm":"305528"},{"hm":"1400565000000","norm":"312543"},{"hm":"1400565300000","norm":"316174"},{"hm":"1400565600000","norm":"193"},{"hm":"1400569200000","norm":"320179"},{"hm":"1400569500000","norm":"320296"},{"hm":"1400569800000","norm":"319636"},{"hm":"1400570100000","norm":"306665"},{"hm":"1400570400000","norm":"308163"},{"hm":"1400570700000","norm":"310024"},{"hm":"1400571000000","norm":"305130"},{"hm":"1400571300000","norm":"309224"},{"hm":"1400571600000","norm":"308874"},{"hm":"1400571900000","norm":"322749"},{"hm":"1400572200000","norm":"326580"},{"hm":"1400572500000","norm":"327568"},{"hm":"1400572800000","norm":"325094"},{"hm":"1400573100000","norm":"322886"},{"hm":"1400573400000","norm":"324014"},{"hm":"1400573700000","norm":"321561"},{"hm":"1400574000000","norm":"321908"},{"hm":"1400574300000","norm":"323087"},{"hm":"1400574600000","norm":"322623"},{"hm":"1400574900000","norm":"321908"},{"hm":"1400575200000","norm":"321205"},{"hm":"1400575500000","norm":"321915"},{"hm":"1400575800000","norm":"325099"},{"hm":"1400576100000","norm":"323737"},{"hm":"1400576400000","norm":"324561"},{"hm":"1400576700000","norm":"321930"},{"hm":"1400577000000","norm":"322103"},{"hm":"1400577300000","norm":"240241"},{"hm":"1400577600000","norm":"274690"},{"hm":"1400577900000","norm":"295224"},{"hm":"1400578200000","norm":"307411"},{"hm":"1400578500000","norm":"315168"},{"hm":"1400578800000","norm":"317217"},{"hm":"1400579100000","norm":"321714"},{"hm":"1400579400000","norm":"324697"},{"hm":"1400579700000","norm":"327647"},{"hm":"1400580000000","norm":"329622"},{"hm":"1400580300000","norm":"326282"},{"hm":"1400580600000","norm":"325711"},{"hm":"1400580900000","norm":"327221"},{"hm":"1400581200000","norm":"330179"},{"hm":"1400581500000","norm":"333713"},{"hm":"1400581800000","norm":"334431"},{"hm":"1400582100000","norm":"339626"},{"hm":"1400582400000","norm":"340184"},{"hm":"1400582700000","norm":"340940"},{"hm":"1400583000000","norm":"343026"},{"hm":"1400583300000","norm":"346453"},{"hm":"1400583600000","norm":"344066"},{"hm":"1400583900000","norm":"345235"},{"hm":"1400584200000","norm":"342700"},{"hm":"1400584500000","norm":"344550"},{"hm":"1400584800000","norm":"344903"},{"hm":"1400585100000","norm":"347443"},{"hm":"1400585400000","norm":"345737"},{"hm":"1400585700000","norm":"346299"},{"hm":"1400586000000","norm":"346324"},{"hm":"1400586300000","norm":"346259"},{"hm":"1400586600000","norm":"348702"},{"hm":"1400586900000","norm":"332585"},{"hm":"1400587200000","norm":"351484"},{"hm":"1400587500000","norm":"320599"},{"hm":"1400587800000","norm":"352343"},{"hm":"1400588100000","norm":"350887"},{"hm":"1400588400000","norm":"358121"},{"hm":"1400588700000","norm":"341763"},{"hm":"1400589000000","norm":"363388"},{"hm":"1400589300000","norm":"344703"},{"hm":"1400589600000","norm":"352719"},{"hm":"1400589900000","norm":"344542"}]
		List<JsonData6> list = new ArrayList<JsonData6>();
		String todayStr = DateUtil.getToday();
		String dateStr = isYesterday ? DateUtil.getYesterday() : todayStr;
		long startTime = DateUtil.DateString2long(dateStr, "yyyyMMdd");
		long endTime = isYesterday ? DateUtil.DateString2long(todayStr, "yyyyMMdd") : System.currentTimeMillis();
		
		for (long i = startTime; i<endTime; i=i+5*60*1000) {
			JsonData6 jd = new JsonData6();
			Date date = new Date(i);
			String hm = DateUtil.date2String(date, "HHmm");
			String norm = getNorm(pvUvList,hm);
			jd.setNorm(norm);
			hm = DateUtil.getRealtimeHm(todayStr, hm);
			jd.setHm(hm);
			list.add(jd);
		}
		
		// 去掉今天数据的小尾巴（最后一个元素）
		if (!isYesterday && list.size()>0) {
			list.remove(list.size() -1);
		}
		
		return JsonUtil.entity2JsonString(list);
	}
	
	private static String getNorm(List<HitPvUv> pvUvList, String hm) {
		if (pvUvList!=null && hm!=null) {
		for (HitPvUv v : pvUvList) {
			if (v!=null && hm.equals(v.getMinute5()) && v.getSum() != null) {
				return v.getSum();
			}
		}
		}
		return "0";
	}
	
	
}
